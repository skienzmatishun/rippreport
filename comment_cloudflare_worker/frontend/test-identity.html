<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Identity System Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-result {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007acc;
        }
        .color-demo {
            width: 100px;
            height: 50px;
            border: 1px solid #ccc;
            margin: 10px 0;
            display: inline-block;
            text-align: center;
            line-height: 50px;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
        }
        .user-info {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a9e;
        }
    </style>
</head>
<body>
    <h1>User Identity and Color System Test</h1>
    
    <div class="test-result">
        <h2>Current User Identity</h2>
        <div id="user-identity"></div>
    </div>
    
    <div class="test-result">
        <h2>Current User Color</h2>
        <div id="user-color"></div>
        <div id="color-demo" class="color-demo">Demo</div>
    </div>
    
    <div class="test-result">
        <h2>Color Consistency Test</h2>
        <p>Testing that the same fingerprint always generates the same color:</p>
        <div id="consistency-test"></div>
    </div>
    
    <div class="test-result">
        <h2>Accessibility Test</h2>
        <div id="accessibility-test"></div>
    </div>
    
    <div class="test-result">
        <h2>Actions</h2>
        <button onclick="runTests()">Run All Tests</button>
        <button onclick="clearIdentity()">Clear Identity (Test New User)</button>
        <button onclick="testMultipleColors()">Test Multiple Colors</button>
    </div>
    
    <div id="multiple-colors-demo"></div>

    <script src="comments.js"></script>
    <script>
        // Initialize comment system for testing
        const commentSystem = new CommentSystem('test-post', 'http://localhost:8787');
        
        function displayUserIdentity() {
            const identity = commentSystem.userIdentity;
            document.getElementById('user-identity').innerHTML = `
                <div class="user-info">
                    <strong>Fingerprint:</strong> ${identity.fingerprint}<br>
                    <strong>Created:</strong> ${identity.created}<br>
                    <strong>Version:</strong> ${identity.version}
                </div>
            `;
        }
        
        function displayUserColor() {
            const color = commentSystem.userColor;
            document.getElementById('user-color').innerHTML = `
                <div class="user-info">
                    <strong>HSL:</strong> ${color.hsl}<br>
                    <strong>Hex:</strong> ${color.hex}<br>
                    <strong>Hue:</strong> ${color.hue}°<br>
                    <strong>Saturation:</strong> ${color.saturation}%<br>
                    <strong>Lightness:</strong> ${color.lightness}%
                </div>
            `;
            
            const demo = document.getElementById('color-demo');
            demo.style.backgroundColor = color.hex;
        }
        
        function runTests() {
            const results = commentSystem.testUserIdentitySystem();
            
            // Display consistency test
            document.getElementById('consistency-test').innerHTML = `
                <div class="user-info">
                    <strong>Result:</strong> ${results.consistent ? '✅ PASS' : '❌ FAIL'}<br>
                    <em>Same fingerprint generates identical colors</em>
                </div>
            `;
            
            // Display accessibility test
            const whiteContrast = commentSystem.getContrastRatio(results.color.hex, '#ffffff');
            const blackContrast = commentSystem.getContrastRatio(results.color.hex, '#000000');
            
            document.getElementById('accessibility-test').innerHTML = `
                <div class="user-info">
                    <strong>White Background Contrast:</strong> ${whiteContrast.toFixed(2)} ${whiteContrast >= 3 ? '✅' : '❌'}<br>
                    <strong>Black Background Contrast:</strong> ${blackContrast.toFixed(2)} ${blackContrast >= 3 ? '✅' : '❌'}<br>
                    <strong>WCAG AA Compliant:</strong> ${results.accessible ? '✅ PASS' : '❌ FAIL'}
                </div>
            `;
        }
        
        function clearIdentity() {
            // Clear cookies and session storage
            document.cookie = 'comment_user_id=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            sessionStorage.removeItem('comment_session_id');
            
            // Reload page to get new identity
            location.reload();
        }
        
        function testMultipleColors() {
            const testFingerprints = [
                'user1-fingerprint',
                'user2-fingerprint', 
                'user3-fingerprint',
                'user4-fingerprint',
                'user5-fingerprint'
            ];
            
            let html = '<div class="test-result"><h2>Multiple User Colors Demo</h2>';
            
            testFingerprints.forEach((fingerprint, index) => {
                const color = commentSystem.assignUserColor(fingerprint);
                const whiteContrast = commentSystem.getContrastRatio(color.hex, '#ffffff');
                const blackContrast = commentSystem.getContrastRatio(color.hex, '#000000');
                
                html += `
                    <div class="user-info" style="border-left: 4px solid ${color.hex}; background: rgba(${commentSystem.hexToRgb(color.hex).r}, ${commentSystem.hexToRgb(color.hex).g}, ${commentSystem.hexToRgb(color.hex).b}, 0.1);">
                        <strong>User ${index + 1}:</strong> ${fingerprint}<br>
                        <strong>Color:</strong> ${color.hex} (${color.hsl})<br>
                        <strong>Contrast:</strong> White: ${whiteContrast.toFixed(2)}, Black: ${blackContrast.toFixed(2)}<br>
                        <div class="color-demo" style="background-color: ${color.hex};">User ${index + 1}</div>
                    </div>
                `;
            });
            
            html += '</div>';
            document.getElementById('multiple-colors-demo').innerHTML = html;
        }
        
        // Initialize display
        displayUserIdentity();
        displayUserColor();
        runTests();
    </script>
</body>
</html>