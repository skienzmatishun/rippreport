<!DOCTYPE html>
<html>
<head>
    <title>Debug Comments</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        .comment { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
        .comment-replies { margin-left: 20px; }
    </style>
</head>
<body>
    <h1>Debug Comments</h1>
    
    <div class="debug">
        <h3>API Test Results:</h3>
        <div id="api-results"></div>
    </div>
    
    <div class="debug">
        <h3>Rendered Comments:</h3>
        <div id="rendered-comments"></div>
    </div>

    <script>
        // Test the API directly
        async function testAPI() {
            try {
                const response = await fetch('https://ai-comment-system.rdunphy.workers.dev/api/comments/newsletter');
                const data = await response.json();
                
                document.getElementById('api-results').innerHTML = `
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Comments Count:</strong> ${data.comments?.length || 0}</p>
                    <p><strong>Total Count:</strong> ${data.totalCount}</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                
                // Test rendering
                if (data.comments && data.comments.length > 0) {
                    const html = data.comments.map(comment => renderComment(comment)).join('');
                    document.getElementById('rendered-comments').innerHTML = html;
                }
                
            } catch (error) {
                document.getElementById('api-results').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
        
        function renderComment(comment, depth = 0) {
            let html = `
                <div class="comment" style="margin-left: ${depth * 20}px;">
                    <strong>${comment.authorName}</strong> - ${new Date(comment.createdAt).toLocaleString()}
                    <div>${comment.content}</div>
            `;
            
            if (comment.replies && comment.replies.length > 0) {
                html += '<div class="comment-replies">';
                comment.replies.forEach(reply => {
                    html += renderComment(reply, depth + 1);
                });
                html += '</div>';
            }
            
            html += '</div>';
            return html;
        }
        
        // Run test on page load
        testAPI();
    </script>
</body>
</html>