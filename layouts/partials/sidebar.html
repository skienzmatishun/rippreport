{{ $sidebar := .Site.Params.sidebar.default }}

{{ if eq .Kind "home" }}
    {{ $sidebar = default .Site.Params.sidebar.home .Params.sidebar }}
{{ else if eq .Kind "page" }}
    {{ $sidebar = default .Site.Params.sidebar.single .Params.sidebar }}
{{ else }}
    {{ $sidebar = default .Site.Params.sidebar.list .Params.sidebar }}
{{ end }}

{{ if $sidebar }}
    <aside class="sidebar{{ if eq $sidebar "left" }} sidebar--left{{ end }}">
        <div id="mc_embed_shell">
            <!-- Mailchimp Styles -->
            <link href="//cdn-images.mailchimp.com/embedcode/classic-061523.css" rel="stylesheet" type="text/css">
            <style type="text/css">
                #mc_embed_signup {
                    background: #fff;
                    clear: left;
                    font: 14px Helvetica, Arial, sans-serif;
                    width: 600px;
                }
                /* Additional styles */
            </style>
            
            <!-- Mailchimp Form -->
            <div style="width: 100%; background: #2d2f32; color: white; padding: 1.25em;" id="mc_embed_signup">
                <!-- Mailchimp Form HTML -->
            </div>
            <script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script>
            <script type="text/javascript">
                // Mailchimp scripts
            </script>
        </div>

        <!-- Backstory Sidebar -->
        <div class="backstory-sidebar">
            <!-- Backstory Logo -->
            <div class="backstory-logo">
                <img src="https://rippreport.com/img/backstory-logo.jpg">
            </div>
            
            <!-- Backstory Social -->
            <div class="backstory-social">
                <a href="https://www.facebook.com/BackstoryPodcast/">{{ partial "svg/facebook.svg" (dict "id" "facebook") }}</a>
                <a style="margin-right: 10px;" href="https://rumble.com/user/BackstoryPodcast">{{ partial "svg/rumble.svg" (dict "id" "rumble") }}</a>
                <a href="mailto:backstory@rippreport.com">{{ partial "svg/email.svg" (dict "id" "email") }}</a>
            </div>
        </div>

        <!-- SoundCloud Embed -->
        <iframe width="100%" height="450" scrolling="no" frameborder="no" allow="autoplay" style="opacity: .8" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/users/696620853&amp;color=%23ff5500&amp;auto_play=false&amp;hide_related=true&amp;show_comments=false&amp;show_user=false&amp;show_reposts=false&amp;show_teaser=false"></iframe>

        {{ $rssURL := "https://api.rss2json.com/v1/api.json?rss_url=http://www.lagniappemobile.com/search/?f=rss&amp;t=article&amp;c=opinion/columnists/dtt&amp;l=50&amp;s=start_time&amp;sd=desc"/> }}
        {{ $numArticles := 8 }}

        {{ if eq .Kind "home" }}
            {{ with getJSON $rssURL }}
                <!-- Torpedo Widget -->
                <div class="torpedo-widget">
                    <h2>Damn the Torpedoes - Lagniappe</h2>
                    <ul>
                        {{ range first $numArticles .items }}
                            <li>
                                <a href="{{ .link }}">{{ .title }}</a>
                                <p>{{ .description }}</p>
                            </li>
                        {{ end }}
                    </ul>
                </div>
            {{ end }}
        {{ end }}

        <!-- Custom Widgets -->
        {{ $root := . }}
        {{ with default .Site.Params.sidebar.widgets .Params.widgets }}
            {{ range $widget := . }}
                {{ $p := printf "widgets/%s.html" $widget }}
                {{ partial $p $root }}
            {{ end }}
        {{ else }}
            <!-- Default Sidebar Warning -->
            <p class="sidebar__warning"><strong>{{ T "sidebar_warning" }}:</strong><br>{{ T "sidebar_recommendation" }}</p>
        {{ end }}
    </aside>
{{ end }}