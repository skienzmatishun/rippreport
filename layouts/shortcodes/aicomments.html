{{/* AI Comment System Shortcode for Hugo Usage: {{< aicomments >}} - Uses page
permalink as ID {{< aicomments "custom-page-id" >}} - Uses custom page ID {{<
aicomments "custom-page-id" "similarity" >}} - Uses custom page ID with AI
similarity ordering by default */}} {{- $pageId := .Page.RelPermalink -}} {{-
$defaultOrdering := "chronological" -}} {{- if .Params -}} {{- if ge (len
.Params) 1 -}} {{- $pageId = index .Params 0 -}} {{- end -}} {{- if ge (len
.Params) 2 -}} {{- $defaultOrdering = index .Params 1 -}} {{- end -}} {{- end
-}}

<!-- AI Comment System Container -->
<div
  id="ai-comment-system"
  data-page-id="{{ $pageId }}"
  data-default-ordering="{{ $defaultOrdering }}"
  class="ai-comments-container"
></div>

<!-- Load AI Comment System CSS -->
<link rel="stylesheet" href="/css/ai-comments.css" />

<!-- Load AI Comment System JavaScript -->
{{ $aiJS := resources.Get "js/ai-comments.js" | resources.Minify }}
<script src="{{ $aiJS.RelPermalink }}"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Get configuration from data attributes
    const container = document.getElementById("ai-comment-system");
    const pageId = container.dataset.pageId;
    const defaultOrdering =
      container.dataset.defaultOrdering || "chronological";

    // Show loading state
    container.innerHTML = `
        <div class="comments-loading" style="
            padding: 40px 20px; 
            text-align: center; 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            border-radius: 8px;
            margin: 20px 0;
        ">
            <div style="
                display: inline-block;
                width: 20px;
                height: 20px;
                border: 2px solid #007bff;
                border-radius: 50%;
                border-top-color: transparent;
                animation: spin 1s linear infinite;
                margin-bottom: 10px;
            "></div>
            <p style="margin: 0; color: #6c757d;">Loading comments...</p>
        </div>
    `;

    // Add loading animation
    const loadingStyle = document.createElement("style");
    loadingStyle.textContent = `
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    `;
    document.head.appendChild(loadingStyle);

    try {
      // Initialize the Comment System
      window.commentSystem = new CommentSystem({
        container: "#ai-comment-system",
        pageId: pageId,
        apiBase: "https://comments.rippreport.com/api",
        autoRefresh: false, // Disable auto-refresh to save API calls
        retryAttempts: 3,
        retryDelay: 1000,
        timeout: 15000,
      });

      // Set default ordering mode if specified (but default to chronological)
      if (defaultOrdering === "similarity") {
        // Wait for the system to initialize, then switch to similarity mode
        setTimeout(() => {
          if (window.commentSystem && window.commentSystem.setOrderingMode) {
            window.commentSystem.setOrderingMode("similarity");
          }
        }, 1000);
      }


    } catch (error) {
      console.error("Failed to initialize AI Comment System:", error);

      // Show error message with retry option
      container.innerHTML = `
            <div class="ai-comments-error" style="
                padding: 20px; 
                background: #f8d7da; 
                border: 1px solid #f5c6cb; 
                border-radius: 8px; 
                text-align: center; 
                color: #721c24;
                margin: 20px 0;
            ">
                <h4 style="margin-bottom: 10px; color: #721c24;">
                    <span style="font-size: 1.2em;">⚠️</span> Comments Temporarily Unavailable
                </h4>
                <p style="margin-bottom: 15px;">The comment system encountered an error while loading.</p>
                <button onclick="location.reload()" style="
                    background: #721c24;
                    color: white;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 14px;
                ">
                    Try Again
                </button>
                <p style="margin-top: 10px; font-size: 12px; opacity: 0.8;">
                    Error: ${error.message || "Unknown error"}
                </p>
            </div>
        `;
    }
  });

  // Add custom styling for better integration with your site
  const aiCommentsStyle = document.createElement("style");
  aiCommentsStyle.textContent = `
    /* Custom styling for comments to match site theme */
    .ai-comments-container {
        margin: 2rem 0;
        font-family: inherit;
        clear: both;
    }
    
    /* Ensure comments blend well with your site's design */
    .ai-comments-container .comment-system {
        background: transparent;
    }
    
    /* Match your site's color scheme */
    .ai-comments-container .form-btn-primary {
        background-color: #000 !important;
        border-color: #000 !important;
        color: #fff !important;
        transition: all 0.2s ease;
    }
    
    .ai-comments-container .form-btn-primary:hover {
        background-color: #333 !important;
        border-color: #333 !important;
        color: #fff !important;
        transform: translateY(-1px);
    }
    
    /* Style the ordering buttons */
    .ai-comments-container .ordering-button {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        color: #495057;
        transition: all 0.2s ease;
    }
    
    .ai-comments-container .ordering-button.active {
        background: #000 !important;
        border-color: #000 !important;
        color: #fff !important;
    }
    
    .ai-comments-container .ordering-button:hover {
        background: #e9ecef;
        border-color: #adb5bd;
    }
    
    .ai-comments-container .ordering-button.active:hover {
        background: #333 !important;
        border-color: #333 !important;
        color: #fff !important;
    }
    
    /* Ensure button text is always white on primary buttons */
    .ai-comments-container .form-btn-primary .btn-text,
    .ai-comments-container .form-btn-primary span {
        color: #fff !important;
    }
    
    /* Comment styling */
    .ai-comments-container .comment {
        border-left: 3px solid #007bff;
        margin-bottom: 1rem;
    }
    
    .ai-comments-container .comment.reply {
        border-left-color: #6c757d;
        margin-left: 2rem;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .ai-comments-container {
            margin: 1rem 0;
        }
        
        .ai-comments-container .comment-form {
            padding: 1rem;
        }
        
        .ai-comments-container .comment.reply {
            margin-left: 1rem;
        }
        
        .ai-comments-container .ordering-controls {
            flex-direction: column;
            gap: 10px;
        }
    }
    
    /* Loading and error states */
    .ai-comments-loading, .ai-comments-error {
        font-family: inherit;
    }
    
    /* Notification styling */
    .ai-comments-notification {
        font-family: inherit;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
`;
  document.head.appendChild(aiCommentsStyle);
</script>
