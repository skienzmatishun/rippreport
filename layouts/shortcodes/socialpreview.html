{{- $url := .Get "url" -}}
{{- $parsedURL := urls.Parse $url -}}
{{- $baseURL := $parsedURL.Host -}}

{{- $image := "" -}}
{{- $title := "" -}}
{{- $description := "" -}}
{{- if eq $baseURL "rippreport.com" -}}
    {{- $json := .Site.GetPage (printf "/p%s" $parsedURL.Path) -}}
    {{- if not $json -}}
        {{- $newURL := print "rippreport.com/p" $parsedURL.Path -}}
        {{- $json := .Site.GetPage $newURL -}}
    {{- end -}}
    {{- with $json.Params.featured_image }}
        {{- $image = . | absURL -}}
    {{- else }}
        {{- $image = "https://rippreport.com/img/placeholder.png" -}}
    {{- end }}
    {{- $title = $json.Title -}}
    {{- $description = $json.Description -}}
{{- else -}}
    {{- $workerURL := (print "https://links.rippreport.com?q=" $url) -}}
    {{- $json := getJSON $workerURL -}}

    {{- if and (isset $json "error") (strings.HasPrefix $json.error "[Error] https://rippreport.com") (strings.Contains $json.error "404") -}}
        {{- if eq $parsedURL.Host "rippreport.com" -}}
            {{- $newURL := print "rippreport.com/p" $parsedURL.Path -}}
            {{- $workerURL := (print "https://links.rippreport.com?q=" $newURL) -}}
            {{- $json := getJSON $workerURL -}}
        {{- end -}}
    {{- end -}}

    {{- $image = $json.image | default "https://rippreport.com/img/placeholder.png" -}}
    {{- $title = $json.title -}}
    {{- $description = $json.description -}}
{{- end -}}



{{- if $image -}}
    <div class="social-preview">
        <a href="{{ $url }}">
            <img loading="lazy" src="{{ $image }}" alt="{{ $title }}">
            <h2>
                {{- if eq $baseURL "www.lagniappemobile.com" -}}
                    {{ partial "svg/lagniappe.svg" (dict "id" "lagniappe") }}
                    <br> {{ $title }}
                {{- else if eq $baseURL "www.al.com" -}}
                    {{ partial "svg/alcom.svg" (dict "id" "alcom") }}
                    <br> {{ $title }}
                {{- else if eq $baseURL "mynbc15.com" -}}
                    {{ partial "svg/wpmi-logo.svg" (dict "id" "wpmi channel 15 news") }}
                    <br> {{ $title }}
                {{- else if eq $baseURL "weartv.com" -}}
                    {{ partial "svg/wear-logo.svg" (dict "id" "WearTV news") }}
                    <br> {{ $title }}
                {{- else if eq $baseURL "1819news.com" -}}
                    {{ partial "svg/1819news.svg" (dict "id" "1819 news") }}
                    <br> {{ $title }}
                {{- else if eq $baseURL "rippreport.com" -}}
                    {{ partial "svg/eagle-logo-preview.svg" (dict "id" "eagle-logo") }}
                    <br> {{ $title }}
                {{- else if eq $baseURL "www.fox10tv.com" -}}
                    {{ partial "svg/wala.svg" (dict "id" "Fox10") }}
                    <br> {{ $title }}
                {{- else if eq $baseURL "www.montgomeryadvertiser.com" -}}
                    {{ partial "svg/montgomery-advertiser.svg" (dict "id" "montgomeryadvertiser") }}
                    <br> {{ $title }}
                {{- else if eq $baseURL "gulfcoastmedia.com" -}}
                    <img loading="lazy" style="height:36px;width:150px;max-width:100%;min-height:36px;" src="https://rippreport.com/img/gulf-coast-media.png" alt="gulf coast media logo">
                    <br> {{ $title | strings.TrimSuffix "- Gulf Coast Media" }}
                {{- else if eq $baseURL "www.gulfcoastnewstoday.com" -}}
                    <img loading="lazy" style="height:36px;width:150px;max-width:100%;min-height:36px;" src="https://rippreport.com/img/gulf-coast-media.png" alt="gulf coast media logo">
                    <br> {{ $title | strings.TrimSuffix "- Gulf Coast Media" }}
                {{- else if eq $baseURL "www.alreporter.com" -}}
                    <img loading="lazy" style="height:46px;width:295px;max-width:100%;" src="https://rippreport.com/img/alreporter.png" alt="AL Reporter logo">
                    <br> {{ $title }}
                {{- else if eq $baseURL "yellowhammernews.com" -}}
                    <img loading="lazy" style="height:32px;width:290px;max-width:100%;" src="https://rippreport.com/img/yellow-hammer-logo.png" alt="Yellow Hammer News Logo">
                    <br> {{ $title | strings.TrimSuffix " - Yellowhammer News"}}
                {{- else if eq $baseURL "www.altoday.com" -}}
                    <img loading="lazy" style="height:50px;width:85px;" src="https://rippreport.com/img/al_today.png">
                    <br> {{ $title | strings.TrimSuffix "altoday.com" }}
                {{- else if eq $baseURL "thefairhopetimes.blogspot.com" -}}
                    {{ $title }}
                {{- else -}}
                    {{ $title }} <br> {{ $baseURL }}
                {{- end -}}
            </h2>
            <p>{{ $description }}</p>
            <span class="read_more">Read More</span>
        </a>
    </div>
{{- else -}}
    <a href="{{ $url }}">{{ $url }}</a>
{{- end -}}
